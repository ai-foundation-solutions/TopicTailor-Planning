graph TD

    subgraph "‚è∞ 1. Scheduler: The Starting Gun"
        A["<b>Start: Pipeline Trigger</b><br/><i>Purpose:</i> Initiate the workflow automatically.<br/><i>Action:</i> Runs the main Python script on a set schedule.<br/><i>Tech:</i> Cron Job (Linux), APScheduler (Python)"]
    end

    subgraph "üë§ 2. User & Data Management: The System's Memory"
        B1["<b>Step 1: Core Topic Selection</b><br/><i>Purpose:</i> Define foundational AI topics as primary content filters.<br/><i>Action:</i> Users select from: Generative AI, Machine Learning, Computer Vision, NLP, AI Ethics, Robotics, AI in Healthcare/Finance, Autonomous Systems, Edge AI, Quantum AI, etc.<br/><i>Tech:</i> Interactive multi-select interface with AI-powered topic suggestions."]
        
        B2["<b>Step 2: Content Type Preferences</b><br/><i>Purpose:</i> Specify preferred content formats within chosen topics.<br/><i>Action:</i> Users choose from: Industry News, Investments & Market Trends, Conferences & Events, Research & Breakthroughs, Product Releases & Benchmarks, Case Studies & Comparisons.<br/><i>Tech:</i> Preference matrix with topic-content type combinations."]
        
        B3["<b>Step 3: Topic Expertise & Technicality</b><br/><i>Purpose:</i> Set knowledge level per topic for tailored content depth.<br/><i>Action:</i> Global default (Beginner/Intermediate/Advanced) with topic-specific overrides. Optional aids: jargon translation, code snippets, math notations, citations, glossaries. Self-assessment sliders for math/code/research comfort.<br/><i>Tech:</i> Dynamic expertise mapping with persona-based prompt selection."]
        
        B4["<b>Step 4: Delivery Scheduling</b><br/><i>Purpose:</i> Customize timing and frequency of content delivery.<br/><i>Action:</i> Specific day/time delivery, daily digest options, urgent breakthrough alerts, timezone preferences.<br/><i>Tech:</i> Flexible scheduling engine with alert prioritization."]
        
        B5["<b>Step 5: Privacy & Data Controls</b><br/><i>Purpose:</i> Manage personalization data and privacy preferences.<br/><i>Action:</i> Opt-in/out controls, profile review/edit, data deletion requests, transparency dashboard.<br/><i>Tech:</i> GDPR-compliant privacy management system."]

        B6["<b>Central Database</b><br/><i>Purpose:</i> Store all persistent user data and preferences.<br/><i>Action:</i> Holds detailed user profiles with topic selections, content preferences, expertise levels per topic, delivery schedules, privacy settings, and historical article URLs.<br/><i>Tech:</i> SQLite / Postgres with structured user preference schema"]
        
        B1 --> B2
        B2 --> B3
        B3 --> B4
        B4 --> B5
        B5 -- "Writes Complete User Profile to DB" --> B6
    end

    subgraph "üì• 3. Content Aggregation: Gathering Raw Materials"
        A --> C1["<b>Fetch from RSS Feeds</b><br/><i>Purpose:</i> Efficiently get the latest headlines from reliable sources.<br/><i>Action:</i> Polls a predefined list of RSS feed URLs.<br/><i>Tech:</i> feedparser"]
        
        C1 --> C2["<b>Scrape Web Pages</b><br/><i>Purpose:</i> Extract full article text from URLs.<br/><i>Action:</i> Visits each link, parses the HTML, and extracts the main body content.<br/><i>Tech:</i> requests, BeautifulSoup"]
        
        C2 -- "Combined List of All Found Articles" --> C3
        
        C3["<b>Filter Out Duplicates</b><br/><i>Purpose:</i> Ensure no article is ever sent twice.<br/><i>Action:</i> Compares the URL of each new article against the historical list of sent URLs from the database.<br/><i>Tech:</i> Python sets for efficient comparison"]
        
        B6 -- "Provides History of Sent URLs" --> C3
        
        C3 -- "List of 100% New Articles" --> C4
        
        C4["<b>Curate by User Preference</b><br/><i>Purpose:</i> Personalize the content for each subscriber.<br/><i>Action:</i> Filters articles based on user's core topics, content type preferences, and expertise-level requirements.<br/><i>Tech:</i> Multi-dimensional preference matching with topic-content type matrix"]
        
        B6 -- "Provides User's Complete Preference Profile" --> C4
    end

    subgraph "üß† 4. AI/NLP Processing: Creating Value"
        C4 -- "List of New, Relevant Articles" --> D1
        
        D1["<b>Generate Persona-Adjusted AI Summaries</b><br/><i>Purpose:</i> Distill articles into digests tailored to the user's topic-specific knowledge level.<br/><i>Action:</i> Sends article text to an LLM with <b>dynamically chosen prompts</b> based on the user's per-topic expertise level (Beginner/Intermediate/Advanced) and preferred stylistic aids (jargon translation, code snippets, math notations, etc.).<br/><i>Tech:</i> Custom Prompt Engineering via OpenAI/Hugging Face API with persona-specific templates"]
        
        B6 -- "Provides Topic-Specific Expertise Levels & Style Preferences" --> D1
        
        D1 --> D2["<b>Analyze & Categorize</b><br/><i>Purpose:</i> Add useful metadata for sorting and display.<br/><i>Action:</i> A second LLM prompt extracts key topics or assigns predefined categories.<br/><i>Tech:</i> LLM-based keyword extraction"]
        
        D2 --> D3["<b>Enrich with Context (Optional)</b><br/><i>Purpose:</i> Add value by explaining complex terms, especially for beginners.<br/><i>Action:</i> Identifies key terms and fetches a simple definition.<br/><i>Tech:</i> Wikipedia API"]
    end

    subgraph "üìù 5. Email Composition: Assembling the Final Product"
        D3 -- "All Processed Content (Summaries, Titles, Links, etc.)" --> E1
        E1["<b>Assemble Newsletter Body</b><br/><i>Purpose:</i> Build the final email content.<br/><i>Action:</i> Formats the titles, summaries, and links into a clean, readable layout.<br/><i>Tech:</i> Markdown templates, converted to HTML"]
        
        E1 --> E2["<b>Create Compelling Subject Line</b><br/><i>Purpose:</i> Maximize email open rates.<br/><i>Action:</i> Uses an LLM to generate a catchy and relevant subject line based on the most important articles.<br/><i>Tech:</i> LLM Prompt"]
    end

    subgraph "üì§ 6. Email Delivery: Sending to Subscribers"
        E2 -- "Final HTML Body & Subject Line" --> F1
        F1["<b>Deliver Email to Subscriber</b><br/><i>Purpose:</i> Send personalized newsletter based on user's delivery schedule.<br/><i>Action:</i> Makes API call to transactional email service, respecting user's preferred delivery time and frequency settings.<br/><i>Tech:</i> SendGrid, AWS SES, Mailjet API with scheduled delivery"]
        
        F1 -- "URLs of Successfully Sent Articles" --> F2
        F2["<b>Update History / Log Results</b><br/><i>Purpose:</i> Close the loop for deduplication and user engagement tracking.<br/><i>Action:</i> Writes the URLs of sent articles back to the database's historical log and updates delivery statistics.<br/><i>Tech:</i> Database INSERT command with user engagement metrics"]
        
        F2 --> B6
    end

    subgraph "‚ö° 7. Major Breakthrough Alerts (Conditional Path)"
        D1 -- "If Summary contains 'breakthrough', etc." --> G1
        G1["<b>Alert Trigger: Detect Breakthrough</b><br/><i>Purpose:</i> Identify and flag high-impact news.<br/><i>Action:</i> Scans summaries for a predefined list of trigger words."]
        
        G1 --> G2["<b>Send Immediate Alert</b><br/><i>Purpose:</i> Notify users of major news without delay.<br/><i>Action:</i> Initiates a separate, expedited email composition and delivery process."]
    end

    F2 --> H["<b>‚úÖ End: Cycle Complete</b>"]